---
import type { FragmentEntry } from '~/utils/get-fragments';
import { getValidDate } from '~/utils/get-fragments';
import { formatDate } from '~/utils/format-date';
import { render as renderMarkdown } from 'astro:content';
import { UI_CONSTANTS } from '~/constants/ui-constants';

type Props = {
  fragment: FragmentEntry;
};

const { fragment } = Astro.props;
const { Content } = await renderMarkdown(fragment);
const publishedAt = getValidDate(fragment.data.publishedAt);
const updatedAt = getValidDate(fragment.data.updatedAt);
// Display publishedAt, fallback to updatedAt
const displayDate = publishedAt || updatedAt;
const fragmentType = fragment.data.fragmentType || [];
---

<article class="fragment-item" data-tags={fragmentType.join(',')}>
  <div
    class="not-prose mb-2 flex items-center gap-3 font-sans text-base font-medium sm:mb-3"
  >
    {
      fragmentType[0] && (
        <a
          class="text-theme-link hover:text-theme-link-hover no-underline opacity-80"
          href={`/fragments?tags=${fragmentType[0]}`}
        >
          {fragmentType[0]}
        </a>
      )
    }
    {
      fragmentType[0] && (
        <span class="h-1 w-1 shrink-0 rounded-full bg-zinc-600 dark:bg-zinc-500" />
      )
    }
    <time class="text-zinc-700 dark:text-zinc-300" datetime={displayDate || ''}>
      {displayDate ? formatDate(displayDate) : ''}
    </time>
  </div>

  <div class:list={[UI_CONSTANTS.PROSE.default, '-mt-1']}>
    <Content />
  </div>
</article>
