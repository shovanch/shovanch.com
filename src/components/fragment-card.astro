---
import type { FragmentEntry } from '~/utils/get-fragments';
import { getValidDate } from '~/utils/get-fragments';
import { formatDate } from '~/utils/format-date';
import { render as renderMarkdown } from 'astro:content';
import { UI_CONSTANTS } from '~/constants/ui-constants';

type Props = {
  fragment: FragmentEntry;
};

const { fragment } = Astro.props;
const { Content } = await renderMarkdown(fragment);
const publishedAt = getValidDate(fragment.data.publishedAt);
const updatedAt = getValidDate(fragment.data.updatedAt);
// Display publishedAt, fallback to updatedAt
const displayDate = publishedAt || updatedAt;
---

<article class="fragment-item">
  <div class="mb-6 flex items-center gap-2">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="text-theme-text-secondary"
    >
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
    </svg>
    <time
      datetime={displayDate || ''}
      class="text-theme-text-secondary font-sans text-lg font-semibold"
    >
      {displayDate ? formatDate(displayDate) : ''}
    </time>
  </div>

  <div class:list={[UI_CONSTANTS.PROSE.default]}>
    <Content />
  </div>
</article>
