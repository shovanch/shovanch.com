---
/**
 * Alias redirect handler for promoted notes
 *
 * Creates 301 redirects from alias routes to canonical routes.
 * Only generates routes for notes that are promoted to surfaces.
 *
 * Example: /notes/ddia-concurrency → 301 → /notes/ddia/concurrency
 */
import type { GetStaticPaths } from 'astro';
import {
  buildNoteManifest,
  validateManifest,
  getAliasPaths,
} from '~/lib/notes/manifest';

export const getStaticPaths = (async () => {
  // Build and validate manifest
  const manifest = await buildNoteManifest();
  validateManifest(manifest);

  // Get only alias paths (not canonical routes)
  return getAliasPaths(manifest);
}) satisfies GetStaticPaths;

interface Props {
  canonicalRoute: string;
}

const { canonicalRoute } = Astro.props;

// 301 permanent redirect to canonical URL
return Astro.redirect(`/notes/${canonicalRoute}`, 301);
---
