---
import BaseHead from '~/components/base-head.astro';
import { defaultMeta } from '~/config/site';
import RootLayout from '~/layouts/root-layout.astro';
import Navigation from '~/components/nav.astro';
import { Image } from 'astro:assets';
import Writings from '~/components/writings.astro';
import HeroBackground from '~/components/hero-background.astro';
import SocialLinks from '~/components/social-links.astro';
import { UI_CONSTANTS } from '~/constants/ui-constants';

import { getCollection } from 'astro:content';
import { render } from 'astro:content';
import Signature from '~/components/signature.astro';

// Fetch hero content from Obsidian notes
const notes = await getCollection('notes');
const heroNote = notes.find((note) => note.id === 'texts/hero');
const { Content: HeroContent } = heroNote
  ? await render(heroNote)
  : { Content: null };
---

<!doctype html>
<html lang="en" class="overflow-x-hidden">
  <head>
    <BaseHead title={defaultMeta.title} description={defaultMeta.description} />
  </head>
  <div class="absolute top-0 left-0 z-0 w-screen overflow-hidden text-red-400">
    <HeroBackground />
  </div>

  <RootLayout>
    <Navigation />

    <section class="mt-4 -mb-4 flex flex-row items-center gap-4 md:mt-8">
      <Image
        priority
        src="/images/avatar.webp"
        alt="Shovan Chatterjee"
        class="h-20 w-20 rounded-full border-4 border-neutral-200 bg-[#fca5a5] object-cover shadow md:h-24 md:w-24"
        width="96"
        height="96"
      />
      <div class="flex flex-col">
        <div class="w-max">
          <Signature className="w-64 md:w-80" />
        </div>
        <div class="-mt-1.5 flex flex-row items-center gap-2.5 md:-mt-2">
          <p class="font-sans text-sm font-medium opacity-75 md:text-lg">
            Engineer, Tinkerer, Explorer
          </p>
        </div>
      </div>
    </section>

    <section id="about" class="flex flex-col gap-8 font-serif md:gap-6">
      <div
        class:list={[
          UI_CONSTANTS.PROSE.default,
          'prose-p:my-1 prose-p:md:my-1.5 max-w-none text-pretty',
          'prose-a:not-prose prose-a:hover:decoration-theme-text prose-a:!pl-0 prose-a:text-lg prose-a:font-medium prose-a:italic prose-a:underline',
          'prose-a:decoration prose-a:mr-1 prose-a:inline-block prose-a:underline prose-a:decoration-dashed prose-a:underline-offset-4',
        ]}
      >
        {HeroContent && <HeroContent />}
      </div>

      <SocialLinks />
    </section>

    <Writings />
  </RootLayout>
</html>
