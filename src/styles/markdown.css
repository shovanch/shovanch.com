@reference "./global.css";

.table-of-contents {
  @apply hidden flex-col lg:flex lg:w-[200px] xl:w-[300px];
  position: fixed;
  bottom: 0;
  font-size: 0.9em;
  left: 4rem;
  z-index: 200;
  overflow: hidden;
  width: 200px;
  @apply lg:top-40;
}

.table-of-contents-anchor {
  @apply mx-2 flex h-7 w-7 items-center justify-center rounded border bg-black text-lg text-[#8887] shadow transition duration-100 md:border-transparent md:shadow-none;
}

.table-of-contents > ul {
  @apply mt-1 rounded pb-5 opacity-0 transition duration-100;
  text-overflow: ellipsis;
  height: 100%;
  overflow-y: auto;
}

*:hover > .table-of-contents > .table-of-contents-anchor,
.table-of-contents > .table-of-contents-anchor {
  @apply text-inherit;
}

.table-of-contents > ul {
  opacity: 0.75;
}

*:hover > .table-of-contents > ul {
  opacity: 0.75;
}

.table-of-contents ul > li::before {
  display: none;
}

.table-of-contents ul > li {
  padding-left: 0.8rem;
  line-height: 1.5em;
  margin-top: 0.5em;
  font-size: 1em;

  @apply font-serif text-neutral-50;
}

.table-of-contents ul > li > a {
  @apply text-sm decoration-blue-900 decoration-wavy underline-offset-2 opacity-75 transition hover:font-medium hover:text-blue-900 hover:underline hover:opacity-100 dark:decoration-blue-100 hover:dark:text-blue-100;
}

.table-of-contents ul > li > a.active {
  @apply text-sm font-semibold text-blue-950 underline decoration-blue-900 decoration-wavy !opacity-100 transition dark:text-blue-100 dark:decoration-blue-100;
}

.code-wrap .line {
  white-space: break-spaces;
}

.markdown-magic-link {
  display: inline-flex;
  align-items: center;
  background: #8882;
  transform: translateY(3px);
  line-height: 100%;
  color: var(--fg-light) !important;
  @apply gap-1 rounded border-0 px-1.5 py-1 transition;
}

.markdown-magic-link:hover {
  background: #8883;
  color: var(--fg) !important;
}

.markdown-magic-link-image {
  display: inline-block;
  height: 1.1em;
  width: 1.1em;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  border-radius: 2px;
}

.markdown-magic-link.markdown-magic-link-github-at {
  transform: translateY(6px);
  @apply gap-1 rounded-full py-0 pr-2 pl-0 text-sm;
}

.markdown-magic-link.markdown-magic-link-github-at .markdown-magic-link-image {
  height: 1.6em;
  width: 1.6em;
  border-radius: 50%;
}

a.header-anchor {
  float: left;
  margin-top: 0.125em;
  margin-left: -1.2em;
  padding-right: 0.5em;
  font-size: 1em;
  opacity: 0;
  text-decoration: none;
  border: 0 !important;
}

a.header-anchor:hover,
a.header-anchor:focus {
  text-decoration: none;
}

h1:hover .header-anchor,
h1:focus .header-anchor,
h2:hover .header-anchor,
h2:focus .header-anchor,
h3:hover .header-anchor,
h3:focus .header-anchor,
h4:hover .header-anchor,
h4:focus .header-anchor,
h5:hover .header-anchor,
h5:focus .header-anchor,
h6:hover .header-anchor,
h6:focus .header-anchor {
  opacity: 0.5;
}

/* Obsidian Image Captions with Responsive Breakout */
figure.obsidian-image {
  @apply mx-0 my-8;
  text-align: center;

  /* Mobile: contained within text column */
  width: 100%;
  margin-left: 0;

  /* Desktop: subtle breakout - about 20% wider than text column */
  @media (min-width: 960px) {
    width: 120%;
    margin-left: -10%;
    max-width: calc(100vw - 8rem);
  }
}

figure.obsidian-image img {
  @apply mx-auto rounded-md;
  max-width: 100%;
  height: auto;
}

figure.obsidian-image figcaption {
  @apply text-theme-text mt-4 text-sm font-medium italic;
  line-height: 1.4;
  max-width: 85%;
  margin-left: auto;
  margin-right: auto;
  padding: 0 1rem;
}

/* Also apply responsive breakout to regular images in prose for consistency */
.prose img:not(figure.obsidian-image img):not(.not-prose img) {
  @apply my-8 rounded-lg shadow-lg;

  /* Mobile: contained within text column */
  width: 100% !important;
  margin-left: 0 !important;

  /* Desktop: subtle breakout - about 20% wider than text column */
  @media (min-width: 960px) {
    width: 120% !important;
    margin-left: -10% !important;
    max-width: calc(100vw - 2rem) !important;
  }
}

/* Sidenotes - Tufte-style marginal notes */
aside.sidenote {
  /* Mobile/tablet: inline with muted styling */
  @apply text-theme-text-secondary my-4 pl-3;
}

aside.sidenote p {
  @apply text-theme-text-secondary my-2;
}

/* Desktop: float to right margin (Tufte-style) */
@media (min-width: 1280px) {
  aside.sidenote {
    @apply float-right clear-right mt-0 -mr-64 mb-4 w-56 border-l-0 pl-0 text-base;
  }

  aside.sidenote p {
    @apply my-0;
  }
}

/* Callouts - Styled aside boxes with badge labels  */
aside.callout {
  @apply relative my-6 rounded-lg px-5 py-4;
  /* Offset top padding to account for badge */
  padding-top: 1.5rem;
}

aside.callout p {
  @apply my-2 first:mt-0 last:mb-0;
}

aside.callout p:first-child {
  @apply mt-0;
}

/* Badge label in top-right corner */
aside.callout::before {
  content: attr(data-callout-type);
  @apply absolute font-sans text-xs font-semibold tracking-wide uppercase;
  top: -0.625rem;
  right: 1rem;
  padding: 0.25rem 0.625rem;
  border-radius: 0.375rem;
}

/* Use title if provided */
aside.callout[data-callout-title]::before {
  content: attr(data-callout-title);
  text-transform: none;
}

/* Callout Type Variants - Light Theme  */

/* Tip - Blue */
aside.callout-tip {
  @apply bg-blue-50;
}
aside.callout-tip::before {
  @apply bg-blue-500 text-white;
}

/* Info - Cyan */
aside.callout-info {
  @apply bg-cyan-50;
}
aside.callout-info::before {
  @apply bg-cyan-500 text-white;
}

/* Note - Gray */
aside.callout-note {
  @apply bg-neutral-100;
}
aside.callout-note::before {
  @apply bg-neutral-500 text-white;
}

/* Warning - Amber */
aside.callout-warning {
  @apply bg-amber-50;
}
aside.callout-warning::before {
  @apply bg-amber-500 text-white;
}

/* Danger - Red */
aside.callout-danger {
  @apply bg-red-50;
}
aside.callout-danger::before {
  @apply bg-red-500 text-white;
}

/* Success - Green */
aside.callout-success {
  @apply bg-green-50;
}
aside.callout-success::before {
  @apply bg-green-500 text-white;
}

/* Caution - Orange */
aside.callout-caution {
  @apply bg-orange-50;
}
aside.callout-caution::before {
  @apply bg-orange-500 text-white;
}

/* Important - Purple */
aside.callout-important {
  @apply bg-purple-50;
}
aside.callout-important::before {
  @apply bg-purple-500 text-white;
}

/* Quote - Slate */
aside.callout-quote {
  @apply bg-slate-100;
}
aside.callout-quote::before {
  @apply bg-slate-500 text-white;
}

/* Callout Dark Theme Variants  */
.dark aside.callout-tip {
  @apply border-blue-700 bg-blue-950/50;
}
.dark aside.callout-tip::before {
  @apply bg-blue-600;
}

.dark aside.callout-info {
  @apply border-cyan-700 bg-cyan-950/50;
}
.dark aside.callout-info::before {
  @apply bg-cyan-600;
}

.dark aside.callout-note {
  @apply border-neutral-600 bg-neutral-800/50;
}
.dark aside.callout-note::before {
  @apply bg-neutral-600;
}

.dark aside.callout-warning {
  @apply border-amber-700 bg-amber-950/50;
}
.dark aside.callout-warning::before {
  @apply bg-amber-600;
}

.dark aside.callout-danger {
  @apply border-red-700 bg-red-950/50;
}
.dark aside.callout-danger::before {
  @apply bg-red-600;
}

.dark aside.callout-success {
  @apply border-green-700 bg-green-950/50;
}
.dark aside.callout-success::before {
  @apply bg-green-600;
}

.dark aside.callout-caution {
  @apply border-orange-700 bg-orange-950/50;
}
.dark aside.callout-caution::before {
  @apply bg-orange-600;
}

.dark aside.callout-important {
  @apply border-purple-700 bg-purple-950/50;
}
.dark aside.callout-important::before {
  @apply bg-purple-600;
}

.dark aside.callout-quote {
  @apply border-slate-600 bg-slate-800/50;
}
.dark aside.callout-quote::before {
  @apply bg-slate-600;
}

/* ===== Callout Blue Theme Variants ===== */
.blue aside.callout {
  @apply border-white/30 bg-white/10;
}

.blue aside.callout::before {
  @apply bg-white/90 text-blue-700;
}

/* External Link Indicator  */
a.external-link::after {
  content: '';
  display: inline-block;
  width: 0.7em;
  height: 0.7em;
  margin-left: 0.2em;
  margin-right: 0.1em;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'/%3E%3Cpolyline points='15 3 21 3 21 9'/%3E%3Cline x1='10' y1='14' x2='21' y2='3'/%3E%3C/svg%3E");
  background-size: contain;
  background-repeat: no-repeat;
  vertical-align: middle;
  opacity: 0.6;
}

/* Dark theme - lighter icon */
.dark a.external-link::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5e5e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'/%3E%3Cpolyline points='15 3 21 3 21 9'/%3E%3Cline x1='10' y1='14' x2='21' y2='3'/%3E%3C/svg%3E");
  opacity: 0.7;
}
